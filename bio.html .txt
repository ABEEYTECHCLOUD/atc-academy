<!doctype html>
<html>
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>A.T.C ACADEMY | Bio Info</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo"><img src="assets/logo.png" alt="logo" style="width:44px;height:44px;object-fit:cover;border-radius:6px"></div>
      <div><div class="title">Complete Bio Information</div><div class="small">Upload documents & details</div></div>
    </div>

    <div class="card">
      <form id="bioForm">
        <div class="form-grid">
          <div class="form-row">
            <label>Gender</label>
            <select id="gender"><option value="">Choose</option><option>Male</option><option>Female</option></select>
          </div>
          <div class="form-row">
            <label>Age</label>
            <input id="age" type="text" />
          </div>
          <div class="form-row">
            <label>Disability?</label>
            <select id="disability"><option value="No">No</option><option value="Yes">Yes</option></select>
          </div>
          <div class="form-row">
            <label>Skills (comma separated)</label>
            <input id="skills" type="text" placeholder="e.g. HTML, Motorcycle repair" />
          </div>
          <div class="form-row full">
            <label>Address</label>
            <input id="address" type="text" />
          </div>
          <div class="form-row">
            <label>Passport Photo</label>
            <input id="passportFile" type="file" accept="image/*" />
          </div>
          <div class="form-row">
            <label>O-Level Statement (PDF / Image)</label>
            <input id="olevelFile" type="file" accept=".pdf,image/*" />
          </div>
          <div class="form-row">
            <label>Certificate (if any)</label>
            <input id="certificateFile" type="file" accept=".pdf,image/*" />
          </div>
        </div>

        <div style="margin-top:12px">
          <button class="btn" type="submit">Save Bio & Upload</button>
          <a href="dashboard.html" class="btn-ghost" style="margin-left:10px">Dashboard</a>
        </div>
        <div id="bioMsg" class="note"></div>
      </form>
    </div>
  </div>

  <script type="module">
    import { onAuth, saveBio } from './script.js';
    const form = document.getElementById('bioForm'), msg = document.getElementById('bioMsg');

    let currentUid = null;
    onAuth(async (user)=>{
      if(!user) return location.href = 'login.html';
      currentUid = user.uid;
    });

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!currentUid) return location.href='login.html';
      msg.textContent='Uploading...';
      try{
        const bioData = {
          gender: document.getElementById('gender').value,
          age: document.getElementById('age').value,
          disability: document.getElementById('disability').value,
          skills: document.getElementById('skills').value,
          address: document.getElementById('address').value
        };
        const files = {
          passportFile: document.getElementById('passportFile').files[0],
          olevelFile: document.getElementById('olevelFile').files[0],
          certificateFile: document.getElementById('certificateFile').files[0]
        };
        await saveBio(currentUid, bioData, files);
        msg.innerHTML = '<span class="success">Bio saved successfully. Go to Dashboard.</span>';
        form.reset();
      }catch(err){
        msg.innerHTML = '<span class="error">'+(err.message||err)+'</span>';
      }
    });
  </script>
</body>
</html>